<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Materiais GPON</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0066cc;
            --primary-dark: #0052a3;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #343a40;
            --border: #dee2e6;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ===== LOGIN ===== */
        .login-container {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .login-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .login-header h1 {
            font-size: 24px;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .login-header p {
            color: #6c757d;
            font-size: 14px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
        }

        input[type="text"],
        input[type="password"] {
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
        }

        input[type="text"]:focus,
        input[type="password"]:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 102, 204, 0.3);
        }

        .alert {
            padding: 12px 15px;
            border-radius: 6px;
            font-size: 14px;
            display: none;
        }

        .alert.show {
            display: block;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .test-users {
            background: var(--light);
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            border-left: 4px solid var(--info);
        }

        .test-users h3 {
            font-size: 12px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .test-users p {
            font-size: 13px;
            color: #6c757d;
            margin: 5px 0;
            font-family: 'Courier New', monospace;
        }

        /* ===== APLICA√á√ÉO PRINCIPAL ===== */
        .app-container {
            display: none;
            flex-direction: column;
            height: 100vh;
            background: var(--light);
        }

        .app-container.show {
            display: flex;
        }

        .navbar {
            background: white;
            border-bottom: 1px solid var(--border);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .navbar h2 {
            color: var(--dark);
            font-size: 20px;
            margin: 0;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info span {
            color: #6c757d;
            font-size: 14px;
        }

        .btn-logout {
            background: var(--danger);
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-logout:hover {
            background: #c82333;
        }

        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 250px;
            background: white;
            border-right: 1px solid var(--border);
            padding: 20px 0;
            overflow-y: auto;
        }

        .nav-item {
            padding: 12px 20px;
            cursor: pointer;
            border-left: 3px solid transparent;
            color: #6c757d;
            font-size: 14px;
            transition: all 0.3s;
        }

        .nav-item:hover {
            background: var(--light);
            color: var(--primary);
        }

        .nav-item.active {
            background: var(--light);
            color: var(--primary);
            border-left-color: var(--primary);
            font-weight: 600;
        }

        .content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .section h2 {
            color: var(--dark);
            margin-bottom: 25px;
            font-size: 24px;
        }

        .form-section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row.full {
            grid-template-columns: 1fr;
        }

        select {
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
        }

        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        .btn-register {
            background: var(--success);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-register:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .table-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        thead {
            background: var(--light);
            border-bottom: 2px solid var(--border);
        }

        th {
            padding: 15px;
            text-align: left;
            color: var(--dark);
            font-weight: 600;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            color: #6c757d;
        }

        tbody tr:hover {
            background: var(--light);
        }

        .btn-delete {
            background: var(--danger);
            color: white;
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .btn-delete:hover {
            background: #c82333;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--primary);
        }

        .stat-card h3 {
            color: #6c757d;
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 10px;
            letter-spacing: 0.5px;
        }

        .stat-card .number {
            color: var(--dark);
            font-size: 28px;
            font-weight: 700;
        }

        .empty-message {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .main-content {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid var(--border);
                display: flex;
                overflow-x: auto;
            }

            .nav-item {
                white-space: nowrap;
                padding: 12px 15px;
            }
        }
    </style>
</head>
<body>
    <!-- LOGIN -->
    <div id="login" class="login-container">
        <div class="login-header">
            <h1>üîê Controle de Materiais</h1>
            <p>GPON - Sistema de Acesso</p>
        </div>

        <div id="loginAlert" class="alert alert-danger"></div>

        <form id="loginForm" onsubmit="fazerLogin(event)">
            <div class="form-group">
                <label for="usuario">üë§ Usu√°rio</label>
                <input type="text" id="usuario" placeholder="Digite seu usu√°rio" required>
            </div>

            <div class="form-group">
                <label for="senha">üîë Senha</label>
                <input type="password" id="senha" placeholder="Digite sua senha" required>
            </div>

            <button type="submit" class="btn btn-primary">üîì Entrar</button>
        </form>

        <div class="test-users">
            <h3>üë§ Usu√°rios de Teste</h3>
            <p>joao / 1234</p>
            <p>matheus / 1234</p>
            <p>pedro / 1234</p>
            <p>admin / admin123</p>
        </div>
    </div>

    <!-- APLICA√á√ÉO -->
    <div id="app" class="app-container">
        <nav class="navbar">
            <h2>üìã Controle de Materiais GPON</h2>
            <div class="user-info">
                <span>üë§ <strong id="usuarioNome"></strong></span>
                <button class="btn-logout" onclick="logout()">Sair</button>
            </div>
        </nav>

        <div class="main-content">
            <div class="sidebar">
                <div class="nav-item active" onclick="mostrarSecao('dashboard')">üìä Dashboard</div>
                <div class="nav-item" onclick="mostrarSecao('registrar')">‚ûï Registrar Material</div>
                <div class="nav-item" onclick="mostrarSecao('listar')">üìã Lista de Materiais</div>
                <div class="nav-item" onclick="mostrarSecao('saidas')">üì¶ Sa√≠das de Campo</div>
                <div class="nav-item" onclick="mostrarSecao('entradas')">üì• Entradas/Devolu√ß√µes</div>
                <div id="navReabastecimento" class="nav-item" onclick="mostrarSecao('reabastecimento')" style="display: none;">üè≠ Reabastecimento Central</div>
                <div id="navUsuarios" class="nav-item" onclick="mostrarSecao('usuarios')" style="display: none;">üë• Gerenciar Usu√°rios</div>
            </div>

            <div class="content">
                <!-- DASHBOARD -->
                <div id="dashboard" class="section active">
                    <h2>üìä Dashboard</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Total de Materiais</h3>
                            <div class="number" id="totalMateriais">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Valor Total em Estoque</h3>
                            <div class="number" id="valorTotal">R$ 0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Sa√≠das Registradas</h3>
                            <div class="number" id="totalSaidas">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Entradas Registradas</h3>
                            <div class="number" id="totalEntradas">0</div>
                        </div>
                    </div>
                </div>

                <!-- REGISTRAR MATERIAL -->
                <div id="registrar" class="section">
                    <h2>‚ûï Registrar Novo Material</h2>
                    <div class="form-section">
                        <form id="formRegistro" onsubmit="registrarMaterial(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="categoria">üì¶ Categoria</label>
                                    <select id="categoria" required>
                                        <option value="">Selecione a categoria</option>
                                        <option value="OLT">OLT (Optical Line Terminal)</option>
                                        <option value="ONU">ONU (Optical Network Unit)</option>
                                        <option value="Splitter">Splitter</option>
                                        <option value="Fibra">Fibra √ìptica</option>
                                        <option value="Conector">Conector</option>
                                        <option value="CTO">CTO</option>
                                        <option value="Emenda">Emenda</option>
                                        <option value="Outros">Outros</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="modelo">üìù Modelo/Descri√ß√£o</label>
                                    <input type="text" id="modelo" placeholder="Ex: ONU Huawei HG8145V5" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="codigo">üîñ C√≥digo</label>
                                    <input type="text" id="codigo" placeholder="Ex: HW001" required>
                                </div>
                                <div class="form-group">
                                    <label for="serie">üè∑Ô∏è S√©rie</label>
                                    <input type="text" id="serie" placeholder="Ex: SN123456">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="lote">üìä Lote</label>
                                    <input type="text" id="lote" placeholder="Ex: LOT-2024-001">
                                </div>
                                <div class="form-group">
                                    <label for="preco">üí∞ Pre√ßo Unit√°rio (R$)</label>
                                    <input type="number" id="preco" placeholder="0.00" step="0.01" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="quantidade">üìà Quantidade em Estoque</label>
                                    <input type="number" id="quantidade" placeholder="0" required>
                                </div>
                                <div class="form-group">
                                    <label for="localizacao">üìç Localiza√ß√£o</label>
                                    <input type="text" id="localizacao" placeholder="Ex: Prateleira A1">
                                </div>
                            </div>

                            <button type="submit" class="btn-register">‚úÖ Registrar Material</button>
                        </form>
                    </div>
                </div>

                <!-- LISTAR MATERIAIS -->
                <div id="listar" class="section">
                    <h2>üìã Lista de Materiais em Estoque</h2>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Categoria</th>
                                    <th>Modelo</th>
                                    <th>C√≥digo</th>
                                    <th>S√©rie</th>
                                    <th>Quantidade</th>
                                    <th>Pre√ßo Unit.</th>
                                    <th>Total</th>
                                    <th>Localiza√ß√£o</th>
                                    <th>A√ß√£o</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaMateriais"></tbody>
                        </table>
                        <div id="emptyMateriais" class="empty-message">Nenhum material registrado</div>
                    </div>
                </div>

                <!-- SA√çDAS -->
                <div id="saidas" class="section">
                    <h2>üì¶ Registrar Sa√≠da de Campo</h2>
                    <div class="form-section">
                        <form id="formSaida" onsubmit="registrarSaida(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="materialSaida">Material</label>
                                    <select id="materialSaida" required>
                                        <option value="">Selecione o material</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="quantidadeSaida">Quantidade Sa√≠da</label>
                                    <input type="number" id="quantidadeSaida" placeholder="0" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="tecnicianoSaida">T√©cnico</label>
                                    <input type="text" id="tecnicianoSaida" placeholder="Nome do t√©cnico" required>
                                </div>
                                <div class="form-group">
                                    <label for="armarioSaida">Arm√°rio/Local</label>
                                    <input type="text" id="armarioSaida" placeholder="Ex: I34, I35" required>
                                </div>
                            </div>

                            <button type="submit" class="btn-register">‚úÖ Registrar Sa√≠da</button>
                        </form>
                    </div>

                    <h3 style="margin-top: 30px; margin-bottom: 15px;">Hist√≥rico de Sa√≠das</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Material</th>
                                    <th>Quantidade</th>
                                    <th>T√©cnico</th>
                                    <th>Arm√°rio</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaSaidas"></tbody>
                        </table>
                        <div id="emptySaidas" class="empty-message">Nenhuma sa√≠da registrada</div>
                    </div>
                </div>

                <!-- ENTRADAS -->
                <div id="entradas" class="section">
                    <h2>üì• Registrar Entrada/Devolu√ß√£o</h2>
                    <div class="form-section">
                        <form id="formEntrada" onsubmit="registrarEntrada(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="materialEntrada">Material</label>
                                    <select id="materialEntrada" required>
                                        <option value="">Selecione o material</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="quantidadeEntrada">Quantidade Entrada</label>
                                    <input type="number" id="quantidadeEntrada" placeholder="0" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="tecnicianoEntrada">T√©cnico</label>
                                    <input type="text" id="tecnicianoEntrada" placeholder="Nome do t√©cnico" required>
                                </div>
                                <div class="form-group">
                                    <label for="observacaoEntrada">Observa√ß√£o</label>
                                    <input type="text" id="observacaoEntrada" placeholder="Devolu√ß√£o, reparo, etc">
                                </div>
                            </div>

                            <button type="submit" class="btn-register">‚úÖ Registrar Entrada</button>
                        </form>
                    </div>

                    <h3 style="margin-top: 30px; margin-bottom: 15px;">Hist√≥rico de Entradas</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Material</th>
                                    <th>Quantidade</th>
                                    <th>T√©cnico</th>
                                    <th>Observa√ß√£o</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaEntradas"></tbody>
                        </table>
                        <div id="emptyEntradas" class="empty-message">Nenhuma entrada registrada</div>
                    </div>
                </div>

                <!-- REABASTECIMENTO CENTRAL (APENAS ADMIN) -->
                <div id="reabastecimento" class="section">
                    <h2>üè≠ Reabastecimento da Central</h2>
                    <div style="background: #d4edda; border: 1px solid #c3e6cb; padding: 15px; border-radius: 6px; margin-bottom: 25px;">
                        <p style="color: #155724; margin: 0;"><strong>üîí Acesso Restrito:</strong> Apenas administrador pode registrar reabastecimento da central</p>
                    </div>

                    <div class="form-section">
                        <form id="formReabastecimento" onsubmit="registrarReabastecimento(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="centralReab">üè≠ Central</label>
                                    <select id="centralReab" required>
                                        <option value="">Selecione a central</option>
                                        <option value="IND">IND - Industrial</option>
                                        <option value="CAN">CAN - Canoas</option>
                                        <option value="NYW">NYW - New York</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="fornecedor">üè¢ Fornecedor</label>
                                    <input type="text" id="fornecedor" placeholder="Ex: Distribuidor XYZ" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="notaFiscal">üìÑ Nota Fiscal/Pedido</label>
                                    <input type="text" id="notaFiscal" placeholder="Ex: NF-2024-001" required>
                                </div>
                                <div class="form-group">
                                    <label for="materialReab">Material</label>
                                    <select id="materialReab" required>
                                        <option value="">Selecione o material</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="quantidadeReab">Quantidade Recebida</label>
                                    <input type="number" id="quantidadeReab" placeholder="0" required>
                                </div>
                                <div class="form-group">
                                    <label for="precoReab">üí∞ Pre√ßo Unit√°rio (R$)</label>
                                    <input type="number" id="precoReab" placeholder="0.00" step="0.01" required>
                                </div>
                            </div>

                            <div class="form-row full">
                                <div class="form-group">
                                    <label for="observacaoReab">Observa√ß√£o</label>
                                    <input type="text" id="observacaoReab" placeholder="Ex: Frete inclu√≠do, Urgente, etc">
                                </div>
                            </div>

                            <button type="submit" class="btn-register">‚úÖ Registrar Reabastecimento</button>
                        </form>
                    </div>

                    <h3 style="margin-top: 30px; margin-bottom: 15px;">Hist√≥rico de Reabastecimentos</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Central</th>
                                    <th>Fornecedor</th>
                                    <th>Material</th>
                                    <th>Quantidade</th>
                                    <th>Pre√ßo Unit.</th>
                                    <th>Total</th>
                                    <th>NF/Pedido</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaReabastecimento"></tbody>
                        </table>
                        <div id="emptyReabastecimento" class="empty-message">Nenhum reabastecimento registrado</div>
                    </div>
                </div>

                <!-- GERENCIAR USU√ÅRIOS (APENAS ADMIN) -->
                <div id="usuarios" class="section">
                    <h2>üë• Gerenciar Usu√°rios</h2>
                    <div style="background: #e7f3ff; border: 1px solid #b3d9ff; padding: 15px; border-radius: 6px; margin-bottom: 25px;">
                        <p style="color: #004085; margin: 0;"><strong>üîê Acesso Restrito:</strong> Apenas administrador pode adicionar e gerenciar usu√°rios do sistema</p>
                    </div>

                    <div class="form-section">
                        <h3 style="margin-bottom: 20px;">‚ûï Adicionar Novo Usu√°rio</h3>
                        <form id="formNovoUsuario" onsubmit="adicionarUsuario(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="novoLogin">üë§ Login (Usu√°rio)</label>
                                    <input type="text" id="novoLogin" placeholder="Ex: carlos" required>
                                </div>
                                <div class="form-group">
                                    <label for="novoNome">üìù Nome Completo</label>
                                    <input type="text" id="novoNome" placeholder="Ex: Carlos Silva" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="novaSenha">üîë Senha</label>
                                    <input type="password" id="novaSenha" placeholder="Digite a senha" required>
                                </div>
                                <div class="form-group">
                                    <label for="novaCentral">üè≠ Central Atribu√≠da</label>
                                    <select id="novaCentral" required>
                                        <option value="">Selecione a central</option>
                                        <option value="IND">IND - Industrial</option>
                                        <option value="CAN">CAN - Canoas</option>
                                        <option value="NYW">NYW - New York</option>
                                    </select>
                                </div>
                            </div>

                            <button type="submit" class="btn-register">‚úÖ Adicionar Usu√°rio</button>
                        </form>
                    </div>

                    <h3 style="margin-top: 30px; margin-bottom: 15px;">üìã Lista de Usu√°rios</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Login</th>
                                    <th>Nome</th>
                                    <th>Central</th>
                                    <th>Data Cria√ß√£o</th>
                                    <th>A√ß√£o</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaUsuarios"></tbody>
                        </table>
                        <div id="emptyUsuarios" class="empty-message">Nenhum usu√°rio registrado</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== BANCO DE DADOS LOCAL =====
        let usuariosDB = {
            'joao': { senha: '1234', nome: 'Jo√£o Silva', central: 'IND' },
            'matheus': { senha: '1234', nome: 'Matheus Costa', central: 'CAN' },
            'pedro': { senha: '1234', nome: 'Pedro Santos', central: 'NYW' },
            'admin': { senha: 'admin123', nome: 'Administrador', central: 'ADM' }
        };

        let usuarioLogado = null;
        let materiais = [];
        let saidas = [];
        let entradas = [];
        let reabastecimentos = [];

        // Carregar dados do localStorage
        function carregarDados() {
            const dados = localStorage.getItem('appDados');
            if (dados) {
                const parsed = JSON.parse(dados);
                materiais = parsed.materiais || [];
                saidas = parsed.saidas || [];
                entradas = parsed.entradas || [];
                reabastecimentos = parsed.reabastecimentos || [];
            }
        }

        // Salvar dados no localStorage
        function salvarDados() {
            localStorage.setItem('appDados', JSON.stringify({
                materiais,
                saidas,
                entradas,
                reabastecimentos
            }));
        }

        // ===== LOGIN =====
        function fazerLogin(e) {
            e.preventDefault();
            const usuario = document.getElementById('usuario').value;
            const senha = document.getElementById('senha').value;
            const alert = document.getElementById('loginAlert');

            if (usuariosDB[usuario] && usuariosDB[usuario].senha === senha) {
                usuarioLogado = { login: usuario, nome: usuariosDB[usuario].nome };
                localStorage.setItem('usuarioLogado', JSON.stringify(usuarioLogado));
                mostrarApp();
                document.getElementById('usuarioNome').textContent = usuarioLogado.nome;
                atualizarDashboard();
                atualizarSelects();
            } else {
                alert.textContent = '‚ùå Usu√°rio ou senha incorretos';
                alert.classList.add('show');
                setTimeout(() => alert.classList.remove('show'), 3000);
            }
        }

        function logout() {
            if (confirm('Deseja realmente sair?')) {
                usuarioLogado = null;
                localStorage.removeItem('usuarioLogado');
                document.getElementById('login').style.display = 'flex';
                document.getElementById('app').classList.remove('show');
                document.getElementById('usuario').value = '';
                document.getElementById('senha').value = '';
            }
        }

        function mostrarApp() {
            document.getElementById('login').style.display = 'none';
            document.getElementById('app').classList.add('show');
            // Mostrar menu admin apenas para admin
            const navReab = document.getElementById('navReabastecimento');
            const navUsr = document.getElementById('navUsuarios');
            if (usuarioLogado.login === 'admin') {
                navReab.style.display = 'block';
                navUsr.style.display = 'block';
            } else {
                navReab.style.display = 'none';
                navUsr.style.display = 'none';
            }
        }

        // ===== NAVEGA√á√ÉO =====
        function mostrarSecao(secao) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(secao).classList.add('active');
            event.target.classList.add('active');

            if (secao === 'listar') atualizarTabelaMateriais();
            if (secao === 'saidas') atualizarTabelaSaidas();
            if (secao === 'entradas') atualizarTabelaEntradas();
        }

        // ===== REGISTRO DE MATERIAL =====
        function registrarMaterial(e) {
            e.preventDefault();
            const material = {
                id: Date.now(),
                categoria: document.getElementById('categoria').value,
                modelo: document.getElementById('modelo').value,
                codigo: document.getElementById('codigo').value,
                serie: document.getElementById('serie').value,
                lote: document.getElementById('lote').value,
                preco: parseFloat(document.getElementById('preco').value),
                quantidade: parseInt(document.getElementById('quantidade').value),
                localizacao: document.getElementById('localizacao').value,
                dataCadastro: new Date().toLocaleDateString('pt-BR')
            };

            materiais.push(material);
            salvarDados();
            document.getElementById('formRegistro').reset();
            alert('‚úÖ Material registrado com sucesso!');
            atualizarDashboard();
            atualizarSelects();
        }

        function atualizarTabelaMateriais() {
            const tbody = document.getElementById('tabelaMateriais');
            const empty = document.getElementById('emptyMateriais');

            tbody.innerHTML = '';

            if (materiais.length === 0) {
                empty.style.display = 'block';
                return;
            }

            empty.style.display = 'none';

            materiais.forEach(m => {
                const total = (m.preco * m.quantidade).toFixed(2);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${m.categoria}</td>
                    <td>${m.modelo}</td>
                    <td>${m.codigo}</td>
                    <td>${m.serie || '-'}</td>
                    <td>${m.quantidade}</td>
                    <td>R$ ${m.preco.toFixed(2)}</td>
                    <td>R$ ${total}</td>
                    <td>${m.localizacao}</td>
                    <td><button class="btn-delete" onclick="deletarMaterial(${m.id})">üóëÔ∏è Deletar</button></td>
                `;
                tbody.appendChild(tr);
            });
        }

        function deletarMaterial(id) {
            if (confirm('Deseja deletar este material?')) {
                materiais = materiais.filter(m => m.id !== id);
                salvarDados();
                atualizarTabelaMateriais();
                atualizarDashboard();
                atualizarSelects();
            }
        }

        // ===== SA√çDAS =====
        function registrarSaida(e) {
            e.preventDefault();
            const materialId = parseInt(document.getElementById('materialSaida').value);
            const quantidade = parseInt(document.getElementById('quantidadeSaida').value);
            const material = materiais.find(m => m.id === materialId);

            if (!material || quantidade > material.quantidade) {
                alert('‚ùå Quantidade insuficiente em estoque');
                return;
            }

            material.quantidade -= quantidade;
            saidas.push({
                id: Date.now(),
                materialId,
                materialNome: material.modelo,
                quantidade,
                tecnico: document.getElementById('tecnicianoSaida').value,
                armario: document.getElementById('armarioSaida').value,
                data: new Date().toLocaleDateString('pt-BR')
            });

            salvarDados();
            document.getElementById('formSaida').reset();
            alert('‚úÖ Sa√≠da registrada com sucesso!');
            atualizarDashboard();
            atualizarSelects();
        }

        function atualizarTabelaSaidas() {
            const tbody = document.getElementById('tabelaSaidas');
            const empty = document.getElementById('emptySaidas');

            tbody.innerHTML = '';

            if (saidas.length === 0) {
                empty.style.display = 'block';
                return;
            }

            empty.style.display = 'none';

            saidas.forEach(s => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${s.data}</td>
                    <td>${s.materialNome}</td>
                    <td>${s.quantidade}</td>
                    <td>${s.tecnico}</td>
                    <td>${s.armario}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // ===== ENTRADAS =====
        function registrarEntrada(e) {
            e.preventDefault();
            const materialId = parseInt(document.getElementById('materialEntrada').value);
            const quantidade = parseInt(document.getElementById('quantidadeEntrada').value);
            const material = materiais.find(m => m.id === materialId);

            if (!material) {
                alert('‚ùå Material n√£o encontrado');
                return;
            }

            material.quantidade += quantidade;
            entradas.push({
                id: Date.now(),
                materialId,
                materialNome: material.modelo,
                quantidade,
                tecnico: document.getElementById('tecnicianoEntrada').value,
                observacao: document.getElementById('observacaoEntrada').value,
                data: new Date().toLocaleDateString('pt-BR')
            });

            salvarDados();
            document.getElementById('formEntrada').reset();
            alert('‚úÖ Entrada registrada com sucesso!');
            atualizarDashboard();
            atualizarSelects();
        }

        function atualizarTabelaEntradas() {
            const tbody = document.getElementById('tabelaEntradas');
            const empty = document.getElementById('emptyEntradas');

            tbody.innerHTML = '';

            if (entradas.length === 0) {
                empty.style.display = 'block';
                return;
            }

            empty.style.display = 'none';

            entradas.forEach(e => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${e.data}</td>
                    <td>${e.materialNome}</td>
                    <td>${e.quantidade}</td>
                    <td>${e.tecnico}</td>
                    <td>${e.observacao || '-'}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // ===== DASHBOARD =====
        function atualizarDashboard() {
            const total = materiais.length;
            const valor = materiais.reduce((acc, m) => acc + (m.preco * m.quantidade), 0);
            
            document.getElementById('totalMateriais').textContent = total;
            document.getElementById('valorTotal').textContent = 'R$ ' + valor.toFixed(2);
            document.getElementById('totalSaidas').textContent = saidas.length;
            document.getElementById('totalEntradas').textContent = entradas.length;
        }

        // ===== SELECTS =====
        function atualizarSelects() {
            const selectSaida = document.getElementById('materialSaida');
            const selectEntrada = document.getElementById('materialEntrada');
            const selectReab = document.getElementById('materialReab');

            selectSaida.innerHTML = '<option value="">Selecione o material</option>';
            selectEntrada.innerHTML = '<option value="">Selecione o material</option>';
            selectReab.innerHTML = '<option value="">Selecione o material</option>';

            materiais.forEach(m => {
                const opt1 = document.createElement('option');
                opt1.value = m.id;
                opt1.textContent = `${m.modelo} (${m.quantidade} em estoque)`;
                selectSaida.appendChild(opt1);

                const opt2 = document.createElement('option');
                opt2.value = m.id;
                opt2.textContent = `${m.modelo} (${m.quantidade} em estoque)`;
                selectEntrada.appendChild(opt2);

                const opt3 = document.createElement('option');
                opt3.value = m.id;
                opt3.textContent = `${m.modelo}`;
                selectReab.appendChild(opt3);
            });
        }

        // ===== REABASTECIMENTO CENTRAL =====
        function registrarReabastecimento(e) {
            e.preventDefault();
            
            // Verificar se √© admin
            if (usuarioLogado.login !== 'admin') {
                alert('‚ùå Acesso negado! Apenas administrador pode registrar reabastecimento');
                return;
            }

            const central = document.getElementById('centralReab').value;
            const materialId = parseInt(document.getElementById('materialReab').value);
            const quantidade = parseInt(document.getElementById('quantidadeReab').value);
            const preco = parseFloat(document.getElementById('precoReab').value);
            const material = materiais.find(m => m.id === materialId);

            if (!material) {
                alert('‚ùå Material n√£o encontrado');
                return;
            }

            material.quantidade += quantidade;
            material.preco = preco; // Atualizar pre√ßo se mudou

            reabastecimentos.push({
                id: Date.now(),
                central,
                materialId,
                materialNome: material.modelo,
                quantidade,
                preco,
                total: (quantidade * preco).toFixed(2),
                fornecedor: document.getElementById('fornecedor').value,
                notaFiscal: document.getElementById('notaFiscal').value,
                observacao: document.getElementById('observacaoReab').value,
                data: new Date().toLocaleDateString('pt-BR'),
                admin: usuarioLogado.nome
            });

            salvarDados();
            document.getElementById('formReabastecimento').reset();
            alert('‚úÖ Reabastecimento registrado com sucesso!');
            atualizarDashboard();
            atualizarSelects();
            atualizarTabelaReabastecimento();
        }

        function atualizarTabelaReabastecimento() {
            const tbody = document.getElementById('tabelaReabastecimento');
            const empty = document.getElementById('emptyReabastecimento');

            tbody.innerHTML = '';

            if (reabastecimentos.length === 0) {
                empty.style.display = 'block';
                return;
            }

            empty.style.display = 'none';

            reabastecimentos.forEach(r => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${r.data}</td>
                    <td>${r.central}</td>
                    <td>${r.fornecedor}</td>
                    <td>${r.materialNome}</td>
                    <td>${r.quantidade}</td>
                    <td>R$ ${r.preco.toFixed(2)}</td>
                    <td>R$ ${r.total}</td>
                    <td>${r.notaFiscal}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // ===== GERENCIAR USU√ÅRIOS =====
        function adicionarUsuario(e) {
            e.preventDefault();

            // Verificar se √© admin
            if (usuarioLogado.login !== 'admin') {
                alert('‚ùå Acesso negado! Apenas administrador pode adicionar usu√°rios');
                return;
            }

            const login = document.getElementById('novoLogin').value.toLowerCase();
            const nome = document.getElementById('novoNome').value;
            const senha = document.getElementById('novaSenha').value;
            const central = document.getElementById('novaCentral').value;

            // Validar se login j√° existe
            if (usuariosDB[login]) {
                alert('‚ùå Este login j√° existe! Escolha outro');
                return;
            }

            // Validar for√ßa da senha
            if (senha.length < 4) {
                alert('‚ùå A senha deve ter no m√≠nimo 4 caracteres');
                return;
            }

            // Adicionar novo usu√°rio
            usuariosDB[login] = {
                senha,
                nome,
                central,
                dataCriacao: new Date().toLocaleDateString('pt-BR')
            };

            salvarDados();
            document.getElementById('formNovoUsuario').reset();
            alert(`‚úÖ Usu√°rio "${login}" adicionado com sucesso!`);
            atualizarTabelaUsuarios();
        }

        function atualizarTabelaUsuarios() {
            const tbody = document.getElementById('tabelaUsuarios');
            const empty = document.getElementById('emptyUsuarios');

            tbody.innerHTML = '';

            const usuarios = Object.entries(usuariosDB);

            if (usuarios.length === 0) {
                empty.style.display = 'block';
                return;
            }

            empty.style.display = 'none';

            usuarios.forEach(([login, dados]) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><strong>${login}</strong></td>
                    <td>${dados.nome}</td>
                    <td>${dados.central}</td>
                    <td>${dados.dataCriacao || 'Sistema'}</td>
                    <td>
                        ${login !== 'admin' ? `<button class="btn-delete" onclick="deletarUsuario('${login}')">üóëÔ∏è Deletar</button>` : '<span style="color: #999;">Protegido</span>'}
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function deletarUsuario(login) {
            if (login === 'admin') {
                alert('‚ùå N√£o √© poss√≠vel deletar o usu√°rio administrador');
                return;
            }

            if (confirm(`Deseja realmente deletar o usu√°rio "${login}"?`)) {
                delete usuariosDB[login];
                salvarDados();
                atualizarTabelaUsuarios();
                alert(`‚úÖ Usu√°rio "${login}" deletado com sucesso!`);
            }
        }

        // ===== INICIALIZA√á√ÉO =====
        window.addEventListener('DOMContentLoaded', () => {
            carregarDados();
            const usuarioArmazenado = localStorage.getItem('usuarioLogado');
            if (usuarioArmazenado) {
                usuarioLogado = JSON.parse(usuarioArmazenado);
                document.getElementById('usuarioNome').textContent = usuarioLogado.nome;
                mostrarApp();
                atualizarDashboard();
                atualizarSelects();
                atualizarTabelaUsuarios();
            }
        });
    </script>
</body>
</html>
